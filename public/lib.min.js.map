{"mappings":"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","sources":["src/index.js","src/computation.js","src/reactive.js","src/utils.js","src/if.js","src/render.js"],"sourcesContent":["export { Computation } from \"./computation\";\nexport { If } from \"./if\";\nexport { Reactive } from \"./reactive\";\nexport {\n  Component,\n  createElement,\n  createTextNode,\n  putNodes,\n  removeNodes,\n  fillTags,\n} from \"./render\";\n","import { Reactive } from \"./reactive.js\";\n\nexport class Computation {\n  constructor(fn, opts) {\n    this.deps = new Set();\n    this.fn = fn;\n    this.timeout = null;\n    this.collect = (_, ptr) => this.deps.add(ptr);\n    this.rerun = (_, ptr) => {\n      if (this.deps.has(ptr)) {\n        if (opts.async) {\n          if (this.timeout) clearTimeout(this.timeout);\n          this.timeout = setTimeout(() => this.run());\n        } else {\n          this.run();\n        }\n      }\n    };\n    if (opts.immediate) this.run();\n  }\n\n  run() {\n    if (this.timeout) {\n      clearTimeout(this.timeout);\n      this.timeout = null;\n    }\n    this.deps.clear();\n    Reactive.sub(this.collect, Reactive.GET);\n    this.fn();\n    Reactive.unsub(this.collect);\n    Reactive.sub(this.rerun, Reactive.ALL - Reactive.GET);\n  }\n\n  stop() {\n    Reactive.unsub(this.rerun);\n    if (this.timeout) clearTimeout(this.timeout);\n  }\n}\n","import { isFn, isObject } from \"./utils.js\";\n\nObject.assign(Reactive, {\n  GET: 1,\n  SET: 2,\n  DEF: 4,\n  DEL: 8,\n  CALL: 16,\n  ALL: 31,\n  OPS: [1, 2, 4, 8, 16],\n  /**\n   * Subscribe\n   * @param {Function} fn callback that will receive operation, path and payload\n   * @param {object|number} operations\n   */\n  sub(fn, operations = Reactive.ALL) {\n    subs.add(fn, operations);\n  },\n  /**\n   * Unsubscribe\n   * @param {Function} fn\n   */\n  unsub(fn) {\n    subs.delete(fn);\n  },\n});\n\nconst subs = new (class {\n  constructor() {\n    Reactive.OPS.map((op) => (this[op] = new Set()));\n  }\n  /**\n   * Add handler.\n   * @param {VoidFunction} fn the handler\n   * @param {number} ops bitmask of values in Reactive.OPS\n   * @void\n   */\n  add(fn, ops) {\n    Reactive.OPS.forEach((op) => ops & op && this[op].add(fn));\n  }\n  /**\n   * Delete handler.\n   * @param {VoidFunction} fn the handler\n   * @void\n   */\n  delete(fn) {\n    Reactive.OPS.forEach((op) => this[op].delete(fn));\n  }\n  /**\n   * Run subscribed handlers.\n   * @param {number} op one of values in Reactive.OPS\n   * @param {string} ptr global JSON pointer\n   * @param {any} payload data specific for the operation\n   */\n  run(op, ptr, payload) {\n    this[op].forEach((fn) => fn(op, ptr, payload));\n  }\n})();\n\n/**\n * Special properties\n */\nconst IS_PROXY = Symbol(),\n  JSON_PTR = Symbol();\n\n/**\n * JSON pointer implementation\n * @see https://datatracker.ietf.org/doc/html/rfc6901\n */\nexport const jsonPtr = {\n  unescape(x) {\n    return x.replaceAll(\"~1\", \"/\").replaceAll(\"~0\", \"~\");\n  },\n  escape(x) {\n    return x.replaceAll(\"~\", \"~0\").replaceAll(\"/\", \"~1\");\n  },\n  /**\n   * Append a key name to the JSON pointer\n   * @param {string} ptr\n   * @param {string} key\n   * @return {string}\n   */\n  append(ptr, key) {\n    return ptr + \"/\" + jsonPtr.escape(key);\n  },\n  /**\n   * Get the name of property pointer points to\n   * @param {string} ptr\n   * @return {string}\n   */\n  propName(ptr) {\n    return jsonPtr.unescape(ptr.split(\"/\").pop());\n  },\n  /**\n   * Get JSON pointer of the object or method\n   * @param {object|function} obj\n   * @return {string?}\n   */\n  of(obj) {\n    if (!isObject(obj) && !isFn(obj)) return;\n    if (!obj[IS_PROXY]) return;\n    return obj[JSON_PTR];\n  },\n};\n\nfunction proxyTraps(path) {\n  return {\n    get: (object, key) => {\n      if (key == IS_PROXY) return true;\n      if (key == JSON_PTR) return path;\n      const ptr = jsonPtr.append(path, key);\n      subs.run(Reactive.GET, ptr);\n      if (isObject(object[key]) && !object[key][IS_PROXY]) {\n        object[key] = new Proxy(object[key], proxyTraps(ptr));\n      }\n      if (isFn(object[key]) && !object[key][IS_PROXY]) {\n        object[key] = new Proxy(object[key], {\n          get: (fn, key) => {\n            if (key == IS_PROXY) return true;\n            if (key == JSON_PTR) return ptr;\n            return fn[key];\n          },\n          apply(fn, $this, args) {\n            subs.run(Reactive.CALL, ptr, args);\n            return fn.apply($this, args);\n          },\n        });\n      }\n      return object[key];\n    },\n    set: (object, key, value) => {\n      if (object[key] !== value) {\n        subs.run(Reactive.SET, jsonPtr.append(path, key), value);\n        object[key] = value;\n      }\n      return true;\n    },\n    defineProperty: (object, key, attrs) => {\n      subs.run(Reactive.DEF, jsonPtr.append(path, key), attrs);\n      Object.defineProperty(object, key, attrs);\n      return true;\n    },\n    deleteProperty: (object, key) => {\n      subs.run(Reactive.DEL, jsonPtr.append(path, key));\n      delete object[key];\n      return true;\n    },\n  };\n}\n\n/**\n * The reactive object\n */\nlet nextId = 0;\nexport function Reactive(value, name = \"\") {\n  return new Proxy(\n    isObject(value) ? value : { value },\n    proxyTraps(\"/$\" + name + (nextId++).toString(36))\n  );\n}\n","export function isObject(x) {\n  return x && typeof x == \"object\";\n}\n\nexport function isFn(x) {\n  return typeof x == \"function\";\n}\n\nexport function isPlainObject(x) {\n  return isObject(x) && (x.constructor == Object || x.constructor == undefined);\n}\n\nexport function noop() {\n  // Does nothing\n}\n\nexport function toArray(x) {\n  if (Array.isArray(x)) return x;\n  if (!x) return [];\n  return [x];\n}\n\nexport const TAG_NAMES =\n  \"a abbr address area article aside audio b base bdi bdo blockquote body br button canvas caption cite code col colgroup data datalist dd del details dfn dialog div dl dt em embed fieldset figcaption figure footer form h1 h2 h3 h4 h5 h6 head header hgroup hr html i iframe img input ins kbd label legend li link main map mark menu meta meter nav noscript object ol optgroup option output p picture pre progress q rp rt ruby s samp script section select slot small source span strong style sub summary sup table tbody td template textarea tfoot th thead time title tr track u ul var video wbr\".split(\n    \" \"\n  );\nexport const SELF_CLOSING_TAGS =\n  \"area base br col embed hr img input link meta source track wbr\".split(\" \");\n\nexport const ARRAY_MUTATING_METHODS =\n  \"push pop shift unshift splice sort reverse fill copyWithin\".split(\" \");\n","import { Computation } from \"./computation.js\";\nimport { Component } from \"./render.js\";\n\nexport class If extends Component {\n  constructor(condition, then, otherwise) {\n    super();\n    this.pivotNode = null;\n    this.then = new Component(then);\n    this.otherwise = new Component(otherwise);\n    this.computation = new Computation(\n      () => {\n        if (condition()) {\n          this.otherwise.unmount();\n          this.then.mount(this.pivotNode);\n        } else {\n          this.then.unmount();\n          this.otherwise.mount(this.pivotNode);\n        }\n      },\n      {\n        async: true,\n      }\n    );\n  }\n\n  mount(pivotNode) {\n    if (this.pivotNode) return;\n    this.pivotNode = pivotNode;\n    this.computation.run();\n  }\n\n  unmount() {\n    if (!this.pivotNode) return;\n    this.pivotNode = null;\n    this.computation.stop();\n    this.then.unmount();\n    this.otherwise.unmount();\n  }\n}\n","import { Computation } from \"./computation.js\";\nimport { SELF_CLOSING_TAGS, TAG_NAMES, toArray } from \"./utils.js\";\n\nconst renderStack = [];\nrenderStack.top = function () {\n  return this[this.length - 1];\n};\n\nfunction isChild(x) {\n  return (\n    [\"string\", \"number\", \"function\"].includes(typeof x) ||\n    x instanceof Node ||\n    x instanceof Component\n  );\n}\n\nexport function createElement(tagName, attributes = {}, ...children) {\n  // Function called as createElement(tagName, ...children);\n  if (isChild(attributes)) {\n    children.unshift(attributes);\n    attributes = {};\n  }\n  const el = document.createElement(tagName);\n  for (const attrName in attributes) {\n    const attrValue = attributes[attrName];\n    if (typeof attrValue == \"function\") {\n      if (attrName.startsWith(\"on\")) {\n        el.addEventListener(attrName.substring(2), attrValue);\n      } else {\n        renderStack.top().computations.add(\n          new Computation(\n            () => {\n              const v = attrValue();\n              if (typeof v == \"boolean\" || v == null) {\n                if (v) {\n                  el.setAttribute(attrName, \"true\");\n                } else {\n                  el.removeAttribute(attrName);\n                }\n              } else {\n                el.setAttribute(attrName, v);\n              }\n            },\n            { async: true, immediate: true }\n          )\n        );\n      }\n    } else {\n      el.setAttribute(attrName, attrValue);\n    }\n  }\n  if (SELF_CLOSING_TAGS.includes(tagName)) return el;\n  for (const child of children.flat()) {\n    if (child instanceof Component) {\n      const pivotNode = document.createComment(\"\");\n      el.appendChild(pivotNode);\n      renderStack.top().components.set(pivotNode, child);\n      child.mount(pivotNode);\n    } else if (child instanceof Node) {\n      el.appendChild(child);\n    } else {\n      el.appendChild(createTextNode(child));\n    }\n  }\n  return el;\n}\n\nexport function fillTags(obj) {\n  for (let t of TAG_NAMES) obj[t] = createElement.bind(null, t);\n}\n\nexport function createTextNode(content) {\n  if (typeof content == \"function\") {\n    let textNode = document.createTextNode(\"\");\n    renderStack.top().computations.add(\n      new Computation(() => (textNode.textContent = String(content())), {\n        async: true,\n        immediate: true,\n      })\n    );\n    return textNode;\n  } else {\n    return document.createTextNode(String(content));\n  }\n}\n\nexport function createDom(renderFunction, ...args) {\n  let components = new Map(),\n    computations = new Set();\n  renderStack.push({ components, computations });\n  try {\n    return { domNodes: renderFunction(...args), components, computations };\n  } finally {\n    renderStack.pop();\n  }\n}\n\nexport function removeNodes(nodes) {\n  toArray(nodes).forEach(\n    (node) => node.parentNode == null || node.parentNode.removeChild(node)\n  );\n}\n\nexport function putNodes(nodes, pivotNode) {\n  toArray(nodes).forEach(\n    (node) =>\n      pivotNode.parentNode != null &&\n      node.parentNode == null &&\n      pivotNode.parentNode.insertBefore(node, pivotNode)\n  );\n}\n\nexport class Component {\n  constructor(renderFn) {\n    if (!renderFn) return;\n    this.renderFn = renderFn.bind(this);\n    this.mounted = false;\n  }\n\n  mount(pivotNode) {\n    if (!this.renderFn || this.mounted) return;\n    Object.assign(this, createDom(this.renderFn));\n    putNodes(this.domNodes, pivotNode);\n    this.mounted = true;\n  }\n\n  mountTo(parentNode) {\n    this.mount(parentNode.appendChild(document.createComment(\"\")));\n  }\n\n  unmount() {\n    if (!this.renderFn || !this.mounted) return;\n    this.components.forEach((c) => c.unmount());\n    this.computations.forEach((c) => c.stop());\n    removeNodes(this.domNodes);\n    this.mounted = false;\n  }\n}\n"],"names":[],"version":3,"file":"lib.min.js.map"}